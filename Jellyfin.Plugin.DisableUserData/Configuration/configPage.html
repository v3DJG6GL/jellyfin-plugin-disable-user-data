<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Disable User Data</title>
</head>
<body>
<div id="DisableUserDataConfigPage"
     data-role="page"
     class="page type-interior pluginConfigurationPage"
     data-require="emby-input,emby-button,emby-checkbox">

    <div data-role="content">
        <div class="content-primary">
            <form id="DisableUserDataConfigForm">
                <h3>Items endpoints</h3>

                <div class="fieldDescription">
                   This is essentially any calls to /Items or /User/{user_id}/Items APIs
                </div>

                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="emby-checkbox-label">
                        <input id="DisableOnAllItems"
                               name="DisableOnAllItems"
                               type="checkbox"
                               is="emby-checkbox" />
                        <span>Disable User Data for ALL item folders</span>
                    </label>
                    <div class="fieldDescription">
                        When checked, UserData is disabled for any <code>GetItems</code> and <code>GetItemsByUserIdLegacy</code>
                        queries. This encompasses a large portion of all views and media types so use with caution, knowing that
                        user-related data won't be present in them. Should be used mostly for testing.

                        This will override any individual checkboxes under this "Items endpoints" header (i.e. Collections right now).
                    </div>
                </div>

                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="emby-checkbox-label">
                        <input id="DisableOnCollections"
                               name="DisableOnCollections"
                               type="checkbox"
                               is="emby-checkbox" />
                        <span>Disable User Data for Collections</span>
                    </label>
                    <div class="fieldDescription">
                        When checked, UserData is disabled for queries that load a Collections View.
                        Applies to <code>GetItems</code> and <code>GetItemsByUserIdLegacy</code>
                    </div>
                </div>

                <hr />

                <h3>Home endpoints</h3>

                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="emby-checkbox-label">
                        <input id="DisableOnContinueWatching"
                               name="DisableOnContinueWatching"
                               type="checkbox"
                               is="emby-checkbox" />
                        <span>Disable User Data for Continue Watching</span>
                    </label>
                    <div class="fieldDescription">
                        Applies to <code>GetResumeItemsLegacy</code> and <code>GetResumeItems</code>.
                    </div>

                    <label class="emby-checkbox-label">
                        <input id="DisableOnNextUp"
                               name="DisableOnNextUp"
                               type="checkbox"
                               is="emby-checkbox" />
                        <span>Disable User Data for Next Up</span>
                    </label>
                    <div class="fieldDescription">
                        Applies to <code>GetNextUp</code>.
                    </div>

                    <label class="emby-checkbox-label">
                        <input id="DisableOnRecentlyAdded"
                               name="DisableOnRecentlyAdded"
                               type="checkbox"
                               is="emby-checkbox" />
                        <span>Disable User Data for Recently Added in Movies and TV Shows</span>
                    </label>
                    <div class="fieldDescription">
                        Applies to <code>GetLatestMedia</code> and <code>GetLatestMediaLegacy</code>.
                    </div>
                </div>

                <div>
                    <button is="emby-button"
                            type="submit"
                            class="raised button-submit block emby-button">
                        <span>Save</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var DisableUserDataConfig = {
            // MUST match Plugin.Id in Plugin.cs
            pluginUniqueId: 'b24c5930-c337-4e0f-977f-1d900629ad09'
        };

        document.querySelector('#DisableUserDataConfigPage')
            .addEventListener('pageshow', function () {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(DisableUserDataConfig.pluginUniqueId)
                    .then(function (config) {
                        document.querySelector('#DisableOnAllItems').checked =
                            config.DisableOnAllItems === undefined ? false : config.DisableOnAllItems;

                        document.querySelector('#DisableOnCollections').checked =
                            config.DisableOnCollections === undefined ? false : config.DisableOnCollections;

                        document.querySelector('#DisableOnContinueWatching').checked =
                            config.DisableOnContinueWatching === undefined ? false : config.DisableOnContinueWatching;

                        document.querySelector('#DisableOnNextUp').checked =
                            config.DisableOnNextUp === undefined ? false : config.DisableOnNextUp;

                        document.querySelector('#DisableOnRecentlyAdded').checked =
                            config.DisableOnRecentlyAdded === undefined ? false : config.DisableOnRecentlyAdded;

                        Dashboard.hideLoadingMsg();
                    });
            });

        document.querySelector('#DisableUserDataConfigForm')
            .addEventListener('submit', function (e) {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(DisableUserDataConfig.pluginUniqueId)
                    .then(function (config) {
                        config.DisableOnAllItems = document.querySelector('#DisableOnAllItems').checked;
                        config.DisableOnCollections = document.querySelector('#DisableOnCollections').checked;
                        config.DisableOnContinueWatching = document.querySelector('#DisableOnContinueWatching').checked;
                        config.DisableOnNextUp = document.querySelector('#DisableOnNextUp').checked;
                        config.DisableOnRecentlyAdded = document.querySelector('#DisableOnRecentlyAdded').checked;

                        ApiClient.updatePluginConfiguration(DisableUserDataConfig.pluginUniqueId, config)
                            .then(function (result) {
                                Dashboard.processPluginConfigurationUpdateResult(result);
                            });
                    });

                e.preventDefault();
                return false;
            });
    </script>
</div>
</body>
</html>
